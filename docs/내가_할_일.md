# 안전지도 웹앱 — 내가 할 일 (체크리스트)

아래 순서대로 진행하면 됩니다. 한 단계 끝날 때마다 체크해 두세요.

> **Git에 올리기:** 폴더를 그대로 올리려다 "파일이 많다"고 나오면, 브라우저 업로드 대신 **터미널에서 Git**으로 올리면 됩니다. → [Git 올리는 방법](Git_올리는_방법.md)

---

## 1단계: 프로젝트 준비

- [ ] **1-1.** 프로젝트 폴더를 연다. (Cursor 또는 터미널에서 해당 폴더로 이동)
- [ ] **1-2.** 터미널에서 아래 명령어로 패키지를 설치한다.
  ```bash
  npm install
  ```
- [ ] **1-3.** (선택) 로컬에서 한 번 실행해 본다.
  ```bash
  npm run dev
  ```
  브라우저에서 `http://localhost:3080` 으로 접속해 보기.  
  **테스트 모드**(교사 테스트 / 학생 테스트)로 UI만 확인해도 된다.  
  이 단계에서는 지도는 안 나와도 된다.

---

## 2단계: Supabase 설정 (데이터 저장용)

- [ ] **2-1.** [Supabase](https://supabase.com) 에 로그인(또는 회원가입)한다.
- [ ] **2-2.** **New Project** 로 새 프로젝트를 만든다.
  - Name, Database Password 정하고, Region 선택 후 **Create new project** 클릭.
- [ ] **2-3.** 프로젝트가 만들어지면 왼쪽 메뉴에서 **SQL Editor** 를 연다.
- [ ] **2-4.** 이 프로젝트 루트에 있는 **`supabase-schema.sql`** 파일을 연다.
- [ ] **2-5.** 그 파일 **전체 내용**을 복사해서 Supabase SQL Editor에 붙여 넣고 **Run** 으로 실행한다.  
  (테이블·인덱스·RLS 등이 생성된다.)
- [ ] **2-6.** 왼쪽 메뉴 **Storage** 로 간다.
- [ ] **2-7.** **New bucket** 으로 버킷을 하나 만든다.
  - Name: `safety-pins`
  - **Public bucket** 에 체크 (사진 공개 접근용)
  - **Create bucket** 클릭.
- [ ] **2-8.** Supabase 왼쪽 메뉴 **Settings** → **API** 로 간다.
- [ ] **2-9.** 아래 세 값을 각각 복사해 둔다.  
  **(실제 키는 이 문서에 붙여넣지 말고, .env.local·Vercel 환경 변수에만 넣으세요.)**
  - **Project URL** → 예: `https://xxxx.supabase.co`
  - **anon public** (API 키)
  - **service_role** (service role key, 비밀에 유지)

---

## 3단계: Vercel에 배포 (정식 URL 만들기)

- [ ] **3-1.** [Vercel](https://vercel.com) 에 로그인(또는 GitHub로 가입)한다.
- [ ] **3-2.** **Add New…** → **Project** 를 선택한다.
- [ ] **3-3.** 이 프로젝트를 가져온다.
  - GitHub에 올려두었다면 저장소를 선택해서 **Import**.
  - 안 올렸다면 **Upload** 로 폴더를 올리거나, 먼저 GitHub에 푸시한 뒤 연결.
- [ ] **3-4.** **Deploy** 를 눌러 첫 배포를 한다.  
  (이때는 아직 환경 변수 없어도 빌드만 되면 OK.)
- [ ] **3-5.** 배포가 끝나면 **배포된 URL** 을 확인한다.  
  예: `https://안전지도웹앱-xxx.vercel.app`  
  이 주소를 **다음 단계(네이버 지도)와 환경 변수**에서 쓴다.

---

## 4단계: 환경 변수 설정 (Vercel + 로컬)

- [ ] **4-1.** Vercel 대시보드에서 **해당 프로젝트** → **Settings** → **Environment Variables** 로 간다.
- [ ] **4-2.** 아래 변수들을 **하나씩** 추가한다. (Name / Value 입력 후 Save)

  | Name | Value | 비고 |
  |------|--------|------|
  | `NEXT_PUBLIC_SUPABASE_URL` | 2단계에서 복사한 **Project URL** | Supabase Settings → API |
  | `NEXT_PUBLIC_SUPABASE_ANON_KEY` | 2단계에서 복사한 **anon public** | 위와 동일 |
  | `SUPABASE_SERVICE_ROLE_KEY` | 2단계에서 복사한 **service_role** | 위와 동일 |
  | `NEXT_PUBLIC_NAVER_MAP_CLIENT_ID` | 5단계에서 발급받은 **Client ID** | 5단계 후 넣어도 됨 |

- [ ] **4-3.** (로컬에서도 돌릴 경우) 프로젝트 **루트**에 **`.env.local`** 파일을 만든다.  
  내용은 위와 동일하게 네 줄을 넣으면 된다.
  ```env
  NEXT_PUBLIC_SUPABASE_URL=https://xxxx.supabase.co
  NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
  SUPABASE_SERVICE_ROLE_KEY=eyJ...
  NEXT_PUBLIC_NAVER_MAP_CLIENT_ID=여기는_5단계_후_넣기
  ```
- [ ] **4-4.** Vercel에서 환경 변수를 저장한 뒤, **Deployments** 탭에서 **Redeploy** 를 한 번 실행한다.

---

## 5단계: 네이버 지도 API (정식 URL 등록)

- [ ] **5-1.** [네이버 클라우드 플랫폼](https://www.ncloud.com/) 에 로그인(또는 회원가입)한다.
- [ ] **5-2.** **Console** → **Application** → **Maps** 메뉴로 이동한다.
- [ ] **5-3.** **Application 등록** 을 클릭한다.
- [ ] **5-4.** 다음처럼 입력한다.
  - **Application 이름**: 예) `안전지도 웹앱`
  - **사용 API**: **Web Dynamic Map**(웹 동적 지도) 선택
  - **사용 URL**: 3단계에서 만든 **배포 URL** 을 넣는다.  
    예) `https://안전지도웹앱-xxx.vercel.app`
- [ ] **5-5.** 저장 후 발급된 **Client ID** 를 복사한다.
- [ ] **5-6.** Vercel **Settings** → **Environment Variables** 에 가서  
  `NEXT_PUBLIC_NAVER_MAP_CLIENT_ID` 의 값에 방금 복사한 **Client ID** 를 넣고 저장한다.  
  (이미 만들어 두었다면 **Edit** 로 값만 수정)
- [ ] **5-7.** Vercel에서 **Redeploy** 를 한 번 더 한다.

---

## 6단계: 동작 확인

- [ ] **6-1.** 배포된 사이트 주소로 접속한다. (예: `https://xxx.vercel.app`)
- [ ] **6-2.** **학급 입장** 으로 들어가서, 아직이면 **테스트 모드** 로도 한 번 써 본다.
- [ ] **6-3.** **교사 입장(학급 만들기)** → 학급 생성 → PIN 확인이 되는지 본다.
- [ ] **6-4.** **학급 입장** → PIN 입력 → 이름 입력 후 들어가는지 본다.
- [ ] **6-5.** **안전점검** → **지도 보기** 에서 지도가 뜨는지 확인한다.
- [ ] **6-6.** **안전점검하기** 로 사진·내용 넣어서 핀 하나 올려 보고, **리스트 보기** 에서 보이는지 확인한다.

---

## 정리: 할 일 순서 한 줄 요약

1. **프로젝트** → `npm install` (필요하면 `npm run dev` 로 로컬 확인)
2. **Supabase** → 프로젝트 생성 → `supabase-schema.sql` 실행 → Storage에 `safety-pins` 버킷 생성 → API 키 3개 복사
3. **Vercel** → 프로젝트 연결 → 배포 → **배포 URL** 확인
4. **환경 변수** → Vercel + (로컬용) `.env.local` 에 Supabase 3개 + (5단계 후) 네이버 지도 1개
5. **네이버 지도** → Maps Application 등록 → 사용 URL에 **배포 URL** 등록 → Client ID 복사 → Vercel env에 넣고 Redeploy
6. **확인** → 배포 URL로 접속해서 학급 입장·지도·핀 올리기 테스트

---

## 자주 하는 질문

- **로컬(localhost)에서는 지도가 안 나와요.**  
  네이버 지도는 **사용 URL**에 등록된 주소에서만 동작합니다. **배포 URL**을 등록한 뒤에는 배포된 사이트에서 지도가 나와야 합니다. 로컬에서도 보고 싶다면 [MAP_API_SETUP.md](MAP_API_SETUP.md)의 "로컬에서 지도 테스트할 때"를 참고해 localhost를 추가로 등록할 수 있습니다.

- **Supabase 스키마 실행 시 에러가 나요.**  
  `auth.users` 를 참조하는 부분에서 에러가 날 수 있습니다. Supabase는 기본으로 Auth가 켜져 있으므로, 그대로 실행해 보세요. 특정 에러 문구가 있다면 그대로 복사해서 팀원이나 개발자에게 보여 주면 됩니다.

- **이미지(사진)가 안 올라가요.**  
  Supabase Storage에 `safety-pins` 버킷을 **Public** 으로 만들었는지, 그리고 `SUPABASE_SERVICE_ROLE_KEY` 를 Vercel 환경 변수에 넣었는지 확인하세요.

이 문서는 **docs/내가_할_일.md** 에 있으므로, 진행할 때마다 열어서 체크하면 됩니다.
